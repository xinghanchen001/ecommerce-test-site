<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPER System - Blutdruck-Test und Analyse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#0056b3',
              ring: '#0056b3',
              input: '#e2e8f0',
              background: '#ffffff',
              foreground: '#0f172a',
              'muted-foreground': '#64748b',
            },
          },
        },
      };
    </script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Helvetica, Arial, sans-serif;
        background-image: url('images/Group-156-p-1080.png');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        min-height: 100vh;
        position: relative;
      }

      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.1);
        z-index: -1;
      }

      .form-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 2rem;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 1.75rem;
      }

      .input {
        display: flex;
        height: 2.25rem;
        width: 100%;
        border-radius: 0.5rem;
        border: 1px solid #e2e8f0;
        background-color: #ffffff;
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        color: #0f172a;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        transition: box-shadow 0.2s ease-in-out;
      }

      .input:focus {
        outline: none;
        border-color: #1e5799;
        box-shadow: 0 0 0 3px rgba(30, 87, 153, 0.2);
      }

      .label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        margin-bottom: 0.5rem;
      }

      .button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.5rem;
        font-size: 1rem;
        font-weight: 600;
        height: 3rem;
        padding-left: 1.5rem;
        padding-right: 1.5rem;
        background-color: #0056b3;
        color: white;
        transition: all 0.2s ease-in-out;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .button:hover {
        background-color: #004494;
        transform: translateY(-1px);
        box-shadow: 0 6px 10px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .error-message {
        color: #ef4444;
        font-size: 0.75rem;
        margin-top: 0.25rem;
      }

      /* Shadcn/UI-Stil für Eingabefelder */
      .shadcn-input {
        flex: 1 1 auto;
        height: 3rem;
        width: 100%;
        border-radius: 0.5rem;
        border: 1px solid #e2e8f0;
        background-color: #ffffff;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        color: #0f172a;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05),
          0 1px 1px 0 rgba(0, 0, 0, 0.03);
        transition: all 0.2s ease-in-out;
      }

      .shadcn-input:focus-visible {
        outline: none;
        border-color: #0056b3;
        box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.2);
      }

      .shadcn-input:disabled {
        cursor: not-allowed;
        opacity: 0.5;
      }

      .shadcn-label {
        display: block;
        font-size: 1rem;
        font-weight: 500;
        line-height: 1.5;
        margin-bottom: 0.75rem;
      }

      .character-count {
        font-size: 0.875rem;
        color: #64748b;
        margin-top: 0.5rem;
        text-align: right;
      }

      .character-count-number {
        font-feature-settings: 'tnum';
        font-variant-numeric: tabular-nums;
      }

      .text-shadow {
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      }

      /* Zusätzliche Stile für bessere Benutzerfreundlichkeit */
      .form-card {
        backdrop-filter: blur(5px);
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .form-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3),
          0 10px 10px -5px rgba(0, 0, 0, 0.2);
      }

      .input-focus-ring {
        transition: all 0.2s ease-in-out;
      }

      .input-focus-ring:focus-within {
        border-color: #0056b3;
        box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.2);
      }

      /* Step visibility control */
      .step {
        display: none;
      }

      .step.active {
        display: block;
      }

      /* Fade transition effect */
      .fade-transition {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
      }

      .fade-transition.show {
        opacity: 1;
      }

      /* Additional styles for analysis results */
      .analysis-card {
        transition: all 0.3s ease-in-out;
      }

      /* Offer cards styling */
      .offer-card {
        transition: all 0.3s ease-in-out;
      }

      .offer-card:hover:not(.disabled) {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2),
          0 10px 10px -5px rgba(0, 0, 0, 0.1);
      }

      .badge {
        display: inline-block;
        padding: 0.35em 0.65em;
        font-size: 0.75em;
        font-weight: 700;
        line-height: 1;
        color: #fff;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 0.25rem;
        background-color: #0056b3;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <main class="container mx-auto py-8 px-4 relative z-10">
      <div class="max-w-3xl mx-auto">
        <!-- Step 1: Data Entry Form -->
        <div id="step-form" class="step active fade-transition show">
          <h1
            class="text-3xl font-bold text-center text-white mb-6 text-shadow"
          >
            Persönliche Blutdruck-Auswertung
          </h1>
          <p
            class="text-xl text-white mb-8 text-center font-medium bg-black bg-opacity-30 py-3 px-4 rounded-lg shadow-sm"
          >
            Bitte geben Sie Ihre Daten ein, um eine individuelle Analyse zu
            erhalten.
          </p>

          <div
            class="bg-white bg-opacity-95 rounded-lg shadow-lg p-6 md:p-10 border border-gray-100 form-card"
          >
            <!-- Hidden form for Netlify bot detection -->
            <form
              name="blood-pressure-test"
              netlify
              netlify-honeypot="bot-field"
              hidden
            >
              <input type="text" name="age" />
              <input type="text" name="systolic" />
              <input type="text" name="diastolic" />
              <input type="text" name="concern" />
              <input type="email" name="email" />
              <input type="text" name="subject" />
            </form>

            <form
              id="bloodPressureForm"
              class="space-y-8"
              name="blood-pressure-test"
              method="POST"
              data-netlify="true"
            >
              <input
                type="hidden"
                name="form-name"
                value="blood-pressure-test"
              />
              <input
                type="hidden"
                name="subject"
                value="Neue Blutdruck-Test Einreichung"
              />
              <!-- Honeypot field for spam protection -->
              <p class="hidden">
                <label>
                  Don't fill this out if you're human:
                  <input name="bot-field" />
                </label>
              </p>
              <div class="input-group input-focus-ring">
                <label for="age" class="shadcn-label">Alter</label>
                <input
                  type="number"
                  id="age"
                  name="age"
                  class="shadcn-input"
                  placeholder="z.B. 45"
                  required
                  min="18"
                  max="120"
                  aria-describedby="age-error"
                />
                <div id="age-error" class="error-message hidden">
                  Bitte geben Sie ein gültiges Alter ein (18-120).
                </div>
                <div id="age-character-count" class="character-count">
                  <span class="character-count-number" id="age-remaining"
                    >0</span
                  >
                  / 3 Zeichen
                </div>
              </div>

              <div class="grid grid-cols-1 gap-6">
                <div class="input-group input-focus-ring">
                  <label for="systolic" class="shadcn-label"
                    >Systolischer Blutdruck (oberer Wert)</label
                  >
                  <input
                    type="number"
                    id="systolic"
                    name="systolic"
                    class="shadcn-input"
                    placeholder="z.B. 120"
                    required
                    min="70"
                    max="250"
                    aria-describedby="systolic-error"
                  />
                  <div id="systolic-error" class="error-message hidden">
                    Bitte geben Sie einen gültigen systolischen Wert ein
                    (70-250).
                  </div>
                  <div id="systolic-character-count" class="character-count">
                    <span class="character-count-number" id="systolic-remaining"
                      >0</span
                    >
                    / 3 Zeichen
                  </div>
                </div>

                <div class="input-group input-focus-ring">
                  <label for="diastolic" class="shadcn-label"
                    >Diastolischer Blutdruck (unterer Wert)</label
                  >
                  <input
                    type="number"
                    id="diastolic"
                    name="diastolic"
                    class="shadcn-input"
                    placeholder="z.B. 80"
                    required
                    min="40"
                    max="150"
                    aria-describedby="diastolic-error"
                  />
                  <div id="diastolic-error" class="error-message hidden">
                    Bitte geben Sie einen gültigen diastolischen Wert ein
                    (40-150).
                  </div>
                  <div id="diastolic-character-count" class="character-count">
                    <span
                      class="character-count-number"
                      id="diastolic-remaining"
                      >0</span
                    >
                    / 3 Zeichen
                  </div>
                </div>
              </div>

              <div class="input-group input-focus-ring">
                <label class="shadcn-label"
                  >Welche Hauptbedenken haben Sie bezüglich der Messergebnisse
                  Ihres aktuellen Hausgeräts?</label
                >
                <div class="space-y-3 mt-2">
                  <div class="flex items-start">
                    <input
                      type="radio"
                      id="concern-none"
                      name="concern"
                      value="Keine Bedenken, sehr zufrieden."
                      class="mt-1 h-4 w-4 text-primary border-gray-300 focus:ring-primary"
                      required
                    />
                    <label
                      for="concern-none"
                      class="ml-3 text-sm font-medium text-gray-700"
                    >
                      Keine Bedenken, sehr zufrieden.
                    </label>
                  </div>

                  <div class="flex items-start">
                    <input
                      type="radio"
                      id="concern-inconsistent"
                      name="concern"
                      value="Mehrmals zur gleichen Zeit gemessen, die Ergebnisse sind unterschiedlich."
                      class="mt-1 h-4 w-4 text-primary border-gray-300 focus:ring-primary"
                    />
                    <label
                      for="concern-inconsistent"
                      class="ml-3 text-sm font-medium text-gray-700"
                    >
                      Mehrmals zur gleichen Zeit gemessen, die Ergebnisse sind
                      unterschiedlich.
                    </label>
                  </div>

                  <div class="flex items-start">
                    <input
                      type="radio"
                      id="concern-feeling"
                      name="concern"
                      value="Die Messergebnisse stimmen nicht mit meinem Körpergefühl überein."
                      class="mt-1 h-4 w-4 text-primary border-gray-300 focus:ring-primary"
                    />
                    <label
                      for="concern-feeling"
                      class="ml-3 text-sm font-medium text-gray-700"
                    >
                      Die Messergebnisse stimmen nicht mit meinem Körpergefühl
                      überein.
                    </label>
                  </div>

                  <div class="flex items-start">
                    <input type="radio" id="concern-error" name="concern"
                    value="Häufige Fehlermeldungen (z.B. \"ERROR\")."
                    class="mt-1 h-4 w-4 text-primary border-gray-300
                    focus:ring-primary" />
                    <label
                      for="concern-error"
                      class="ml-3 text-sm font-medium text-gray-700"
                    >
                      Häufige Fehlermeldungen (z.B. "ERROR").
                    </label>
                  </div>
                </div>
              </div>

              <div class="input-group input-focus-ring">
                <label for="email" class="shadcn-label">E-Mail-Adresse</label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  class="shadcn-input"
                  placeholder="ihre.email@beispiel.de"
                  required
                  aria-describedby="email-error"
                />
                <div id="email-error" class="error-message hidden">
                  Bitte geben Sie eine gültige E-Mail-Adresse ein.
                </div>
                <div id="email-character-count" class="character-count">
                  <span class="character-count-number" id="email-remaining"
                    >0</span
                  >
                  Zeichen
                </div>
              </div>

              <button
                type="submit"
                id="submitButton"
                class="button w-full h-12 text-base hover:scale-105 transition-transform"
              >
                <span id="buttonText" class="mr-2">Jetzt testen</span>
                <svg
                  id="buttonIcon"
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
                    clip-rule="evenodd"
                  />
                </svg>
                <svg
                  id="loadingIcon"
                  class="animate-spin h-5 w-5 hidden"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                  ></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
              </button>
            </form>
          </div>
        </div>

        <!-- Step 2: Loading Animation -->
        <div id="step-loading" class="step fade-transition">
          <h1
            class="text-3xl font-bold text-center text-white mb-6 text-shadow"
          >
            Ihre Blutdruck-Analyse wird erstellt
          </h1>

          <div
            class="bg-white bg-opacity-95 rounded-lg shadow-lg p-8 md:p-12 border border-gray-100 form-card"
          >
            <div class="text-center py-12">
              <div
                class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-primary"
              ></div>
              <p class="mt-6 text-xl text-gray-700">
                Ihre Daten werden analysiert...
              </p>
              <p class="mt-3 text-gray-500">
                Bitte haben Sie einen Moment Geduld
              </p>
            </div>
          </div>
        </div>
        <!-- Step 3: Analysis Results -->
        <div id="step-result" class="step fade-transition">
          <h1
            class="text-3xl font-bold text-center text-white mb-6 text-shadow"
          >
            Ihre Blutdruck-Analyse
          </h1>

          <div
            class="bg-white bg-opacity-95 rounded-lg shadow-lg p-6 md:p-10 border border-gray-100 form-card"
          >
            <div class="mb-8">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                  <p class="text-sm text-gray-500">Alter</p>
                  <p id="result-age-value" class="text-2xl font-medium">-</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                  <p class="text-sm text-gray-500">Systolischer Wert</p>
                  <p id="result-systolic-value" class="text-2xl font-medium">
                    -
                  </p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                  <p class="text-sm text-gray-500">Diastolischer Wert</p>
                  <p id="result-diastolic-value" class="text-2xl font-medium">
                    -
                  </p>
                </div>
              </div>
            </div>

            <div class="border-t border-gray-200 pt-6">
              <h2 class="text-xl font-semibold mb-4">Analyse:</h2>
              <div id="analysis-message" class="p-4 rounded-lg mb-6">
                <!-- Analyse-Nachricht wird hier eingefügt -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Products section - replaced content -->
    <section id="products-section" class="py-16 md:py-24 bg-white hidden">
      <div class="container mx-auto px-4 md:px-6">
        <div class="flex flex-col items-center text-center mb-12">
          <div class="badge mb-2">Limitiertes Angebot</div>
          <h2 class="text-3xl md:text-4xl font-bold tracking-tight mb-4">
            Unsere exklusive Vorabvermarktung – nur für die Schnellsten!
          </h2>
          <p class="text-lg text-gray-600 max-w-2xl mb-8">
            Sichern Sie sich jetzt Ihr BPER System zu einem der begrenzt
            verfügbaren Sonderangebote.
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Angebot 1 -->
          <div
            class="opacity-100 bg-white rounded-xl p-6 border-4 border-green-500 flex flex-col h-full relative overflow-hidden shadow-lg"
          >
            <div
              class="absolute top-0 right-0 bg-green-500 text-white py-1 px-4 rounded-bl-lg text-sm font-medium"
            >
              Aktuell
            </div>
            <h3 class="text-xl font-bold mb-2">
              Earlybird Preis für die ersten 200 Stk.
            </h3>
            <div class="text-3xl font-bold mb-4">199 €</div>
            <ul class="mb-6 flex-1 space-y-2 text-sm">
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span
                  >1 Jahr Subsription fuer Leistungsfaehigkeit Bewertung durch
                  APP</span
                >
              </li>
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span>1 Jahr kostenlose Online-Datenspeicherung</span>
              </li>
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span>0 Risiko-90 Tage Geld zurueck Garantie</span>
              </li>
            </ul>
            <div class="mb-4 text-sm text-gray-500 font-semibold">
              ab Juni 2025 lieferbar
            </div>
            <p class="text-sm text-gray-600 mb-4">
              Dieses Angebot ist einzigartig und begrenzt – perfekt für den, der
              sofort handelt und die maximale Unterstützung sucht. Nur eine
              Reservierung pro Person möglich, um Exklusivität und Fairness zu
              gewährleisten.
            </p>
            <a
              class="text-blue-600 hover:underline text-sm block mb-4"
              href="/klarna-payment-info"
            >
              Mehr zu Klarna Zahlungsoptionen →
            </a>
            <a
              href="javascript:void(0)"
              class="mt-auto w-full py-2 bg-green-500 hover:bg-green-600 text-white rounded-xl transition duration-300 block text-center checkout-button"
            >
              Jetzt Angebot sichern
            </a>
          </div>

          <!-- Angebot 2 -->
          <div
            class="opacity-60 bg-white rounded-xl p-6 flex flex-col h-full relative overflow-hidden shadow-lg"
          >
            <h3 class="text-xl font-bold mb-2">Einführungs-Angebot</h3>
            <div class="text-3xl font-bold mb-4">259 €</div>
            <ul class="mb-6 flex-1 space-y-2 text-sm">
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span
                  >1 Jahr Subskription fuer Leistungsfaehigkeit Bewertung durch
                  APP</span
                >
              </li>
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span>1 Jahr kostenlose Online-Datenspeicherung</span>
              </li>
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span>0 Risiko-90 Tage Geld zurueck Garantie</span>
              </li>
            </ul>
            <div class="mb-4 text-sm text-gray-500 font-semibold">
              erhaeltlich online ab August 2025
            </div>
            <p class="text-sm text-gray-600 mb-4">
              Dieses Angebot ist für alle die den EarlyBird Rabatt verpasst
              haben oder sich nicht qualifiziert haben.
            </p>
            <a
              class="text-blue-600 hover:underline text-sm block mb-4"
              href="/klarna-payment-info"
            >
              Mehr zu Klarna Zahlungsoptionen →
            </a>
            <a
              href="javascript:void(0)"
              class="mt-auto w-full py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-xl transition duration-300 block text-center checkout-button"
            >
              Jetzt reservieren
            </a>
          </div>

          <!-- Angebot 3 -->
          <div
            class="bg-gray-50 rounded-xl p-6 border border-gray-200 flex flex-col h-full opacity-60"
          >
            <h3 class="text-xl font-bold mb-2">Offizieller Preis</h3>
            <div class="text-3xl font-bold mb-4">359 €</div>
            <ul class="mb-6 flex-1 space-y-2 text-sm">
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span
                  >1 Jahr Subskription fuer Leistungsfaehigkeit Bewertung durch
                  APP</span
                >
              </li>
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span>1 Jahr kostenlose Online-Datenspeicherung</span>
              </li>
              <li class="flex items-start">
                <svg
                  class="w-5 h-5 text-green-500 mr-2 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  ></path>
                </svg>
                <span>0 Risiko-90 Tage Geld zurueck Garantie</span>
              </li>
            </ul>
            <div class="mb-4 text-sm text-gray-500 font-semibold">
              erhaeltlich online und in Apotheke ab Januar 2026
            </div>
            <p class="text-sm text-gray-600 mb-4">
              Der offizielle Preis bei Serienproduktion.
            </p>

            <a
              class="text-blue-600 hover:underline text-sm block mb-4"
              href="/klarna-payment-info"
            >
              Mehr zu Klarna Zahlungsoptionen →
            </a>
            <a
              href="javascript:void(0)"
              class="mt-auto w-full py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-xl transition duration-300 block text-center checkout-button"
            >
              Jetzt vorbestellen
            </a>
          </div>
        </div>

        <!-- Hinweisblock mit voller Breite -->
        <div
          class="mt-10 p-5 bg-yellow-50 border border-yellow-200 rounded-lg w-full"
        >
          <p
            class="text-sm md:text-base font-medium text-yellow-800 text-center"
          >
            <span class="font-bold">Achtung:</span> Handeln Sie schnell! Unsere
            Produktion ist noch im Aufbau, und die ersten 200 Geräte sind
            begrenzt. Wenn Ihr Blutdruck noch nicht täglich überwacht werden
            muss, empfehlen wir Ihnen, vorerst zu warten – wir wollen die
            Ressourcen für die dringendsten Fälle nutzen.
          </p>
        </div>
      </div>
    </section>
    <!-- JavaScript for form handling and step transitions -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // DOM-Elemente für Formular
        const form = document.getElementById('bloodPressureForm');
        const ageInput = document.getElementById('age');
        const systolicInput = document.getElementById('systolic');
        const diastolicInput = document.getElementById('diastolic');
        const emailInput = document.getElementById('email');
        const submitButton = document.getElementById('submitButton');
        const buttonText = document.getElementById('buttonText');
        const buttonIcon = document.getElementById('buttonIcon');
        const loadingIcon = document.getElementById('loadingIcon');

        // DOM-Elemente für Schritte
        const stepForm = document.getElementById('step-form');
        const stepLoading = document.getElementById('step-loading');
        const stepResult = document.getElementById('step-result');
        const productsSection = document.getElementById('products-section');

        // Character count elements
        const ageRemaining = document.getElementById('age-remaining');
        const systolicRemaining = document.getElementById('systolic-remaining');
        const diastolicRemaining = document.getElementById(
          'diastolic-remaining'
        );
        const emailRemaining = document.getElementById('email-remaining');

        // Validierungsfunktionen
        function validateAge(age) {
          return age >= 18 && age <= 120;
        }

        function validateSystolic(systolic) {
          return systolic >= 70 && systolic <= 250;
        }

        function validateDiastolic(diastolic) {
          return diastolic >= 40 && diastolic <= 150;
        }

        function validateEmail(email) {
          const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return re.test(email);
        }

        // Fehlermeldungen anzeigen/verstecken
        function showError(inputId, show) {
          const errorElement = document.getElementById(`${inputId}-error`);
          if (errorElement) {
            if (show) {
              errorElement.classList.remove('hidden');
            } else {
              errorElement.classList.add('hidden');
            }
          }
        }

        // Character count updaten
        function updateCharacterCount(input, countElement) {
          if (input && countElement) {
            const length = input.value.length;
            countElement.textContent = length;
          }
        }

        // Funktion zum Wechseln zwischen den Schritten
        function goToStep(step) {
          // Verstecke alle Schritte
          [stepForm, stepLoading, stepResult].forEach((el) => {
            if (el) {
              el.classList.remove('active', 'show');
            }
          });

          // Zeige gewählten Schritt
          if (step === 'form') {
            stepForm.classList.add('active');
            setTimeout(() => stepForm.classList.add('show'), 50);
            productsSection.classList.add('hidden');
          } else if (step === 'loading') {
            stepLoading.classList.add('active');
            setTimeout(() => stepLoading.classList.add('show'), 50);
            productsSection.classList.add('hidden');
          } else if (step === 'result') {
            stepResult.classList.add('active');
            productsSection.classList.remove('hidden');
            setTimeout(() => stepResult.classList.add('show'), 50);
          }
        }

        // Input-Validierung und Character Count bei Änderung
        ageInput.addEventListener('input', function () {
          showError('age', this.value && !validateAge(parseInt(this.value)));
          updateCharacterCount(this, ageRemaining);
        });

        systolicInput.addEventListener('input', function () {
          showError(
            'systolic',
            this.value && !validateSystolic(parseInt(this.value))
          );
          updateCharacterCount(this, systolicRemaining);
        });

        diastolicInput.addEventListener('input', function () {
          showError(
            'diastolic',
            this.value && !validateDiastolic(parseInt(this.value))
          );
          updateCharacterCount(this, diastolicRemaining);
        });

        emailInput.addEventListener('input', function () {
          showError('email', this.value && !validateEmail(this.value));
          updateCharacterCount(this, emailRemaining);
        });

        // Formular-Validierung und Step-Übergang
        form.addEventListener('submit', function (event) {
          event.preventDefault();

          const age = parseInt(ageInput.value);
          const systolic = parseInt(systolicInput.value);
          const diastolic = parseInt(diastolicInput.value);
          const email = emailInput.value;

          // Get selected concern
          const concernRadios = document.getElementsByName('concern');
          let selectedConcern = '';
          for (const radio of concernRadios) {
            if (radio.checked) {
              selectedConcern = radio.value;
              break;
            }
          }

          // Alle Felder validieren
          const isAgeValid = validateAge(age);
          const isSystolicValid = validateSystolic(systolic);
          const isDiastolicValid = validateDiastolic(diastolic);
          const isEmailValid = validateEmail(email);
          const isConcernValid = selectedConcern !== '';

          // Fehlermeldungen anzeigen
          showError('age', !isAgeValid);
          showError('systolic', !isSystolicValid);
          showError('diastolic', !isDiastolicValid);
          showError('email', !isEmailValid);

          // Wenn alle Validierungen bestanden wurden
          if (
            isAgeValid &&
            isSystolicValid &&
            isDiastolicValid &&
            isEmailValid &&
            isConcernValid
          ) {
            // Zeige Ladeanimation
            buttonText.textContent = 'Wird gesendet...';
            buttonIcon.classList.add('hidden');
            loadingIcon.classList.remove('hidden');
            submitButton.disabled = true;

            // Speichern der Daten im localStorage
            const bloodPressureData = {
              age,
              systolic,
              diastolic,
              concern: selectedConcern,
              email,
            };

            localStorage.setItem(
              'bloodPressureData',
              JSON.stringify(bloodPressureData)
            );

            // Wechsle zum Loading-Step
            goToStep('loading');

            // Prüfen, ob wir auf einem lokalen Server sind
            const isLocalServer =
              window.location.hostname === 'localhost' ||
              window.location.hostname === '127.0.0.1' ||
              window.location.hostname.includes('192.168');

            // Simuliere eine kurze Verzögerung für bessere UX
            setTimeout(() => {
              // Formular-Daten an den Server senden (falls auf Produktionsserver)
              if (!isLocalServer) {
                // Erstelle ein FormData-Objekt für die Netlify-Submission
                const formData = new FormData(form);

                // Verwende fetch für bessere Kontrolle über den Prozess
                fetch('/', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                  },
                  body: new URLSearchParams(formData).toString(),
                })
                  .then(() => {
                    console.log('Form successfully submitted to Netlify');
                  })
                  .catch((error) => {
                    console.error('Netlify form submission error:', error);
                  });
              } else {
                // Auf lokalem Server: Daten in der Konsole ausgeben
                console.log(
                  'Lokaler Server erkannt. Formular-Daten:',
                  bloodPressureData
                );

                // Zusätzlich: Daten an den lokalen Server senden, falls dieser sie verarbeiten kann
                try {
                  fetch('http://localhost:3002/save-form-data', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(bloodPressureData),
                  }).catch((err) =>
                    console.log(
                      'Server-Anfrage fehlgeschlagen, ignoriert im lokalen Modus'
                    )
                  );
                } catch (e) {
                  console.log(
                    'Fehler beim Senden an lokalen Server, wird ignoriert'
                  );
                }
              }

              // Nach kurzer Zeit zum Ergebnis-Step wechseln
              setTimeout(() => {
                // Zeige die eingegebenen Werte im Ergebnis an
                document.getElementById('result-age-value').textContent = age;
                document.getElementById('result-systolic-value').textContent =
                  systolic;
                document.getElementById('result-diastolic-value').textContent =
                  diastolic;

                // Analysiere die Blutdruckwerte
                analyzeBloodPressure(age, systolic, diastolic);

                // Wechsle zum Ergebnis-Step
                goToStep('result');

                // Button zurücksetzen
                buttonText.textContent = 'Jetzt testen';
                buttonIcon.classList.remove('hidden');
                loadingIcon.classList.add('hidden');
                submitButton.disabled = false;
              }, 2000);
            }, 1500);
          }
        });

        // Funktion zur Analyse der Blutdruckwerte
        function analyzeBloodPressure(age, systolic, diastolic) {
          const analysisElement = document.getElementById('analysis-message');
          let analysisText = '';
          let category = '';
          let analysisClass = ''; // CSS class for styling the result box

          // Check for Hypotension first
          if (systolic < 90 || diastolic < 70) {
            category = 'Niedriger Blutdruck (Hypotonie)';
            analysisText =
              'Ihr Blutdruck ist niedrig. Wenn Sie Symptome wie Schwindel oder Müdigkeit verspüren, sollten Sie ärztlichen Rat suchen.';
            analysisClass = 'bg-cyan-50 text-cyan-800'; // Hypotension = Cyan/Light Blue
          }
          // Standard Blood Pressure Categories (based on ESC/ESH guidelines)
          else if (systolic < 120 && diastolic < 80) {
            category = 'Optimal';
            analysisText =
              'Ihr Blutdruck ist optimal. Pflegen Sie weiterhin einen gesunden Lebensstil.';
            analysisClass = 'bg-green-50 text-green-800'; // Optimal = Green
          } else if (systolic <= 129 && diastolic <= 84) {
            category = 'Normal';
            analysisText =
              'Ihr Blutdruck ist normal. Regelmäßige Kontrollen sind dennoch empfehlenswert.';
            analysisClass = 'bg-blue-50 text-blue-800'; // Normal = Blue
          } else if (systolic <= 139 || diastolic <= 89) {
            category = 'Hochnormal';
            analysisText =
              'Ihr Blutdruck ist hochnormal. Achten Sie auf Ihren Lebensstil und kontrollieren Sie Ihren Blutdruck regelmäßig. Das BPER System kann Sie dabei unterstützen.';
            analysisClass = 'bg-yellow-50 text-yellow-800'; // High-Normal = Yellow
          } else if (systolic <= 159 || diastolic <= 99) {
            category = 'Hypertonie Grad 1';
            analysisText =
              'Ihr Blutdruck entspricht einer Hypertonie Grad 1 (leichte Hypertonie). Lebensstiländerungen werden empfohlen, ärztliche Beratung kann sinnvoll sein. Eine genaue Überwachung mit dem BPER System ist ratsam.';
            analysisClass = 'bg-orange-50 text-orange-800'; // Grade 1 = Orange
          } else if (systolic <= 179 || diastolic <= 109) {
            category = 'Hypertonie Grad 2';
            analysisText =
              'Ihr Blutdruck entspricht einer Hypertonie Grad 2 (mittelschwere Hypertonie). Ärztliche Beratung ist dringend empfohlen. Das BPER System hilft, den Verlauf genau zu dokumentieren.';
            analysisClass = 'bg-red-50 text-red-800'; // Grade 2 = Red
          } else if (systolic >= 180 || diastolic >= 110) {
            category = 'Hypertonie Grad 3';
            analysisText =
              'Ihr Blutdruck entspricht einer Hypertonie Grad 3 (schwere Hypertonie). Suchen Sie umgehend ärztliche Hilfe auf! Dies kann ein medizinischer Notfall sein.';
            analysisClass = 'bg-red-700 text-white font-bold'; // Grade 3 = Dark Red, White text
          } else if (systolic >= 140 && diastolic < 90) {
            // Specific case: Isolated Systolic Hypertension
            category = 'Isolierte Systolische Hypertonie';
            analysisText =
              'Sie haben eine isolierte systolische Hypertonie (nur der obere Wert ist erhöht). Ärztliche Beratung wird empfohlen. Das BPER System kann helfen, Muster zu erkennen.';
            analysisClass = 'bg-orange-50 text-orange-800'; // Treat similar to Grade 1 for styling
          } else {
            // Fallback for unexpected values, though validation should prevent this
            category = 'Nicht klassifizierbar';
            analysisText =
              'Ihre Werte konnten nicht eindeutig klassifiziert werden. Bitte überprüfen Sie die Eingabe oder konsultieren Sie einen Arzt.';
            analysisClass = 'bg-gray-100 text-gray-800';
          }

          // Add age-specific advice (optional, can be refined)
          if (age > 65 && category !== 'Optimal' && category !== 'Normal') {
            analysisText +=
              ' In Ihrem Alter ist eine konsequente Blutdruckkontrolle besonders wichtig.';
          }

          // Add general advice about dynamic nature of blood pressure
          if (category.includes('Hypertonie') || category === 'Hochnormal') {
            analysisText +=
              ' Bedenken Sie: Blutdruck ist dynamisch. Einzelmessungen geben nur einen Schnappschuss. Das BPER System ermöglicht eine umfassendere Betrachtung Ihres Blutdruckverlaufs.';
          }

          // Set Analysis Text and Class
          analysisElement.innerHTML = `<p class="font-semibold mb-2">Kategorie: ${category}</p><p>${analysisText}</p>`; // Added category display
          analysisElement.className = `p-4 rounded-lg mb-6 ${analysisClass}`;
        }

        // Initial character counts
        updateCharacterCount(ageInput, ageRemaining);
        updateCharacterCount(systolicInput, systolicRemaining);
        updateCharacterCount(diastolicInput, diastolicRemaining);
        updateCharacterCount(emailInput, emailRemaining);

        // Prüfe, ob wir von einer anderen Seite zurückgekehrt sind
        const storedData = localStorage.getItem('bloodPressureData');
        if (storedData) {
          try {
            const parsedData = JSON.parse(storedData);

            // Fülle Formular-Felder mit gespeicherten Daten
            if (parsedData.age) ageInput.value = parsedData.age;
            if (parsedData.systolic) systolicInput.value = parsedData.systolic;
            if (parsedData.diastolic)
              diastolicInput.value = parsedData.diastolic;
            if (parsedData.email) emailInput.value = parsedData.email;

            // Update character counts
            updateCharacterCount(ageInput, ageRemaining);
            updateCharacterCount(systolicInput, systolicRemaining);
            updateCharacterCount(diastolicInput, diastolicRemaining);
            updateCharacterCount(emailInput, emailRemaining);

            // Setze betreffendes Radio-Button
            if (parsedData.concern) {
              const concernRadios = document.getElementsByName('concern');
              for (const radio of concernRadios) {
                if (radio.value === parsedData.concern) {
                  radio.checked = true;
                  break;
                }
              }
            }
          } catch (e) {
            console.error('Fehler beim Parsen der gespeicherten Daten:', e);
          }
        }
      });
    </script>

    <!-- Stripe Integration -->
    <script src="https://js.stripe.com/v3/"></script>
    <script>
      // Initialize Stripe.js with your publishable key
      const stripe = Stripe(
        'pk_live_51QyFM2A9aibyk7ocyoijP7A9gPKC0oDS0HlySiSEuCOaS4sndnS1HZn9fyKPkf48ERT7FPaoxOWwvesYKKSy7N5J003rxyTc2b'
      );

      // Function to handle checkout process
      async function handleCheckout(event) {
        try {
          // 如果是通过链接点击触发的，阻止默认行为
          if (event && event.preventDefault) {
            event.preventDefault();
          }

          // Extract click ID from URL if present
          function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null
              ? ''
              : decodeURIComponent(results[1].replace(/\+/g, ' '));
          }

          // Get click ID from URL
          const clickId = getUrlParameter('cid');
          console.log('Click ID from URL:', clickId);

          // 获取跟踪URL（如果有）
          let trackingUrl = null;
          if (event && event.currentTarget) {
            // 从按钮的data属性获取跟踪URL
            if (
              event.currentTarget.dataset &&
              event.currentTarget.dataset.trackingUrl
            ) {
              trackingUrl = event.currentTarget.dataset.trackingUrl;
            }
          }

          // 如果有跟踪URL，先发送跟踪请求
          if (trackingUrl) {
            try {
              console.log('Sending tracking request to:', trackingUrl);
              // 创建一个图像对象来发送跟踪请求（常见的跟踪方法）
              const trackingImg = new Image();
              trackingImg.src = trackingUrl + '?t=' + new Date().getTime();
              // 等待一小段时间以确保跟踪请求有时间发送
              await new Promise((resolve) => setTimeout(resolve, 100));
            } catch (trackingError) {
              console.error('Tracking error:', trackingError);
              // 即使跟踪失败，也继续结账流程
            }
          }

          // For local testing
          if (
            window.location.hostname === 'localhost' ||
            window.location.hostname === '127.0.0.1' ||
            window.location.hostname.includes('192.168')
          ) {
            console.log('Local development environment detected');
            alert(
              'In der lokalen Entwicklungsumgebung ist die Checkout-Funktion nicht vollständig verfügbar. Bei Bereitstellung auf Netlify wird diese Funktion aktiviert.'
            );
            return;
          }

          // On production, use relative URL to avoid certificate issues
          const endpointUrl = '/api/create-checkout';
          console.log('Using endpoint:', endpointUrl);

          // Call your backend to create a Checkout Session
          const response = await fetch(endpointUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              priceId: 'price_1RI4RCA9aibyk7oc22okGK2W', // Updated Price ID
              clickId: clickId, // Pass the click ID to the checkout endpoint
            }),
          });

          const session = await response.json();

          // Show error if there was a problem
          if (session.error) {
            console.error('Session error:', session.error);
            alert(
              'Es gab ein Problem mit dem Checkout. Bitte versuchen Sie es später noch einmal.'
            );
            return;
          }

          // Redirect to Stripe Checkout
          const result = await stripe.redirectToCheckout({
            sessionId: session.id,
          });

          if (result.error) {
            console.error('Redirect error:', result.error);
            alert(result.error.message);
          }
        } catch (error) {
          console.error('Checkout error:', error);
          alert(
            'Es gab ein Problem mit dem Checkout. Bitte versuchen Sie es später noch einmal.'
          );
        }
      }

      // Add event listeners for Stripe checkout buttons
      document.addEventListener('DOMContentLoaded', function () {
        // Get all buy buttons
        const buyButtons = document.querySelectorAll('.checkout-button');

        // Add checkout handler to all buy buttons
        buyButtons.forEach((button) => {
          if (button) {
            button.addEventListener('click', handleCheckout);
          }
        });
      });
    </script>
  </body>
</html>
